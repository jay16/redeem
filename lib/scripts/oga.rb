# encoding: utf-8
require 'oga'
require 'json'

xml =<<-XML
<SOAP-ENV:Envelope xmlns:SOAP-ENV="http://schemas.xmlsoap.org/soap/envelope/" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:SOAP-ENC="http://schemas.xmlsoap.org/soap/encoding/"><SOAP-ENV:Body SOAP-ENC:encodingStyle="http://schemas.xmlsoap.org/soap/envelope/"><NS1:LogInResponse xmlns:NS1="urn:HDCRMWebServiceIntf-IHDCRMWebService"><return xsi:type="xsd:boolean">true</return><sClientCookie xsi:type="xsd:string">73536573443D39303543453142313332383934394646423737453331383343383937323231350D0A4F7065723D484443524D5B305D0D0A53746F72654769643D313030303030300D0A53746F7265436F64653D303231300D0A576F726B53746174696F6E3D3137322E31372E3130342E3136340D0A557365724769643D313030303234350D0A55736572436F64653D69706164696F6E49</sClientCookie></NS1:LogInResponse></SOAP-ENV:Body></SOAP-ENV:Envelope>
XML

response_return = ''
response_cookie = ''
document = Oga.parse_xml(xml)
document.xpath("Envelope/Body/LogInResponse").each do |res|
  puts res.at_xpath('return').text
  puts res.at_xpath('sClientCookie').text
end

xml =<<-XML
<?xml version="1.0"?>
<SOAP-ENV:Envelope xmlns:SOAP-ENV="http://schemas.xmlsoap.org/soap/envelope/" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:SOAP-ENC="http://schemas.xmlsoap.org/soap/encoding/"><SOAP-ENV:Body SOAP-ENC:encodingStyle="http://schemas.xmlsoap.org/soap/envelope/"><NS1:DoClientCommandResponse xmlns:NS1="urn:HDCRMWebServiceIntf-IHDCRMWebService"><return xsi:type="xsd:int">0</return><sErrMsg xsi:type="xsd:string"></sErrMsg><sOutParams xsi:type="xsd:string">{"FRESULT":0,"FDATA":[{"GNDNAME":"10\/10 Apothecary","GNDCODE":"N148","RN":"1","GNDGID":"1000000"},{"GNDNAME":"Ercuis&amp;Raynaud","GNDCODE":"L302","RN":"2","GNDGID":"1000200"},{"GNDNAME":"Adidas","GNDCODE":"N109","RN":"3","GNDGID":"1000001"},{"GNDNAME":"Adidas(Home Court)","GNDCODE":"L370","RN":"4","GNDGID":"1000002"},{"GNDNAME":"Alexandre de Paris","GNDCODE":"L216","RN":"5","GNDGID":"1000003"},{"GNDNAME":"APM MONACO","GNDCODE":"L269","RN":"6","GNDGID":"1000004"},{"GNDNAME":"Ashworth","GNDCODE":"L254","RN":"7","GNDGID":"1000005"},{"GNDNAME":"Asics","GNDCODE":"L339","RN":"8","GNDGID":"1000006"},{"GNDNAME":"AUM","GNDCODE":"L350","RN":"9","GNDGID":"1000007"},{"GNDNAME":"Awfully Chocolate","GNDCODE":"LG155","RN":"10","GNDGID":"1000008"},{"GNDNAME":"Lian Viet&amp;Thai Cuisine","GNDCODE":"L319","RN":"11","GNDGID":"1000009"},{"GNDNAME":"BAOBAO ISSEY MIYAKE&amp;PLEATS  PLEASE&amp;Me ISSEY MIYAKE","GNDCODE":"L204","RN":"12","GNDGID":"1000010"},{"GNDNAME":"BIBIGO","GNDCODE":"LG220","RN":"13","GNDGID":"1000011"},{"GNDNAME":"Calzedonia","GNDCODE":"LG180","RN":"14","GNDGID":"1000012"},{"GNDNAME":"Carhartt","GNDCODE":"LG158","RN":"15","GNDGID":"1000013"},{"GNDNAME":"Carre D'artistes","GNDCODE":"L390","RN":"16","GNDGID":"1000014"},{"GNDNAME":"Caudalie","GNDCODE":"N150","RN":"17","GNDGID":"1000015"},{"GNDNAME":"Chanel","GNDCODE":"L119","RN":"18","GNDGID":"1000016"},{"GNDNAME":"City Super","GNDCODE":"LG207","RN":"19","GNDGID":"1000017"},{"GNDNAME":"CK Jeans","GNDCODE":"L257","RN":"20","GNDGID":"1000018"},{"GNDNAME":"CK Performance","GNDCODE":"L337","RN":"21","GNDGID":"1000019"},{"GNDNAME":"CK Underwear","GNDCODE":"LG127","RN":"22","GNDGID":"1000020"},{"GNDNAME":"Clarks","GNDCODE":"LG173","RN":"23","GNDGID":"1000021"},{"GNDNAME":"Columbia","GNDCODE":"L320","RN":"24","GNDGID":"1000022"},{"GNDNAME":"Bar. Constellation","GNDCODE":"L161","RN":"25","GNDGID":"1000023"},{"GNDNAME":"C.P.U","GNDCODE":"LG165","RN":"26","GNDGID":"1000024"},{"GNDNAME":"Delonghi","GNDCODE":"L312","RN":"27","GNDGID":"1000025"},{"GNDNAME":"Denham","GNDCODE":"L268","RN":"28","GNDGID":"1000026"},{"GNDNAME":"Diptyque","GNDCODE":"L105","RN":"29","GNDGID":"1000027"},{"GNDNAME":"Ecco","GNDCODE":"L275","RN":"30","GNDGID":"1000028"},{"GNDNAME":"Ed Hardy Skinwear","GNDCODE":"LG125","RN":"31","GNDGID":"1000029"},{"GNDNAME":"Ei Mio","GNDCODE":"LG217","RN":"32","GNDGID":"1000030"},{"GNDNAME":"Elsa Lee","GNDCODE":"L286","RN":"33","GNDGID":"1000031"},{"GNDNAME":"Evisu","GNDCODE":"LG121","RN":"34","GNDGID":"1000032"},{"GNDNAME":"Fessura","GNDCODE":"LG172","RN":"35","GNDGID":"1000033"},{"GNDNAME":"Folli Follie","GNDCODE":"LG174","RN":"36","GNDGID":"1000034"},{"GNDNAME":"Fresh Everyday","GNDCODE":"LG177","RN":"37","GNDGID":"1000035"},{"GNDNAME":"Garrett Popcorn","GNDCODE":"LG129","RN":"38","GNDGID":"1000036"},{"GNDNAME":"Godiva","GNDCODE":"LG109","RN":"39","GNDGID":"1000037"},{"GNDNAME":"H.GENTEEL","GNDCODE":"L344","RN":"40","GNDGID":"1000038"},{"GNDNAME":"Hera","GNDCODE":"N146","RN":"41","GNDGID":"1000039"},{"GNDNAME":"Hunter Gatherer","GNDCODE":"LG161","RN":"42","GNDGID":"1000040"},{"GNDNAME":"I DO","GNDCODE":"LG126","RN":"43","GNDGID":"1000041"},{"GNDNAME":"I-PRIMO","GNDCODE":"L256","RN":"44","GNDGID":"1000042"},{"GNDNAME":"initial","GNDCODE":"LG152","RN":"45","GNDGID":"1000043"},{"GNDNAME":"L.J Nail salon","GNDCODE":"LG179","RN":"46","GNDGID":"1000044"},{"GNDNAME":"J.D.V","GNDCODE":"LG116","RN":"47","GNDGID":"1000045"},{"GNDNAME":"Jade Garden","GNDCODE":"LG101","RN":"48","GNDGID":"1000046"},{"GNDNAME":"JiNS","GNDCODE":"LG115","RN":"49","GNDGID":"1000047"},{"GNDNAME":"Joy&amp;Peace","GNDCODE":"L277","RN":"50","GNDGID":"1000048"},{"GNDNAME":"Jurlique SPA","GNDCODE":"N152B","RN":"51","GNDGID":"1000049"},{"GNDNAME":"King Baby","GNDCODE":"LG167","RN":"52","GNDGID":"1000050"},{"GNDNAME":"Le Fame","GNDCODE":"L316","RN":"53","GNDGID":"1000051"},{"GNDNAME":"Lenscrafters","GNDCODE":"L288","RN":"54","GNDGID":"1000052"},{"GNDNAME":"Les Nereides","GNDCODE":"L284","RN":"55","GNDGID":"1000053"},{"GNDNAME":"Let's Taipei","GNDCODE":"LG108","RN":"56","GNDGID":"1000054"},{"GNDNAME":"Little Nanyang","GNDCODE":"LG219","RN":"57","GNDGID":"1000055"},{"GNDNAME":"Lululemon","GNDCODE":"L245&amp;L251","RN":"58","GNDGID":"1000056"},{"GNDNAME":"Mathilde M","GNDCODE":"LG123","RN":"59","GNDGID":"1000057"},{"GNDNAME":"Max Mara","GNDCODE":"L208","RN":"60","GNDGID":"1000058"},{"GNDNAME":"Miss Sixty","GNDCODE":"LG157","RN":"61","GNDGID":"1000059"},{"GNDNAME":"THE PEACOCK ROOM","GNDCODE":"S301","RN":"62","GNDGID":"1000060"},{"GNDNAME":"Molokai","GNDCODE":"LG181","RN":"63","GNDGID":"1000061"},{"GNDNAME":"Moussy\/Sly","GNDCODE":"LG146","RN":"64","GNDGID":"1000062"},{"GNDNAME":"Msteak by Bunlife","GNDCODE":"LG204","RN":"65","GNDGID":"1000063"},{"GNDNAME":"New Balance","GNDCODE":"L378","RN":"66","GNDGID":"1000064"},{"GNDNAME":"NIKE KICKS LOUNGE","GNDCODE":"N105","RN":"67","GNDGID":"1000065"},{"GNDNAME":"N-one","GNDCODE":"L311","RN":"68","GNDGID":"1000066"},{"GNDNAME":"Onitsuka Tiger","GNDCODE":"LG170","RN":"69","GNDGID":"1000067"},{"GNDNAME":"Paris Blanc &amp; Le Reve","GNDCODE":"S113","RN":"70","GNDGID":"1000068"},{"GNDNAME":"Pearl Deluxe","GNDCODE":"L301","RN":"71","GNDGID":"1000069"},{"GNDNAME":"Poa","GNDCODE":"L379A","RN":"72","GNDGID":"1000070"},{"GNDNAME":"PUMA BLACK\/SELECT","GNDCODE":"N215","RN":"73","GNDGID":"1000071"},{"GNDNAME":"Rococo","GNDCODE":"LG175","RN":"74","GNDGID":"1000072"},{"GNDNAME":"RUCO LINE","GNDCODE":"L292","RN":"75","GNDGID":"1000073"},{"GNDNAME":"Sandra Jewellery","GNDCODE":"L394","RN":"76","GNDGID":"1000074"},{"GNDNAME":"Sisley","GNDCODE":"L127","RN":"77","GNDGID":"1000075"},{"GNDNAME":"Starbucks Roastery","GNDCODE":"N110&amp;N212","RN":"78","GNDGID":"1000076"},{"GNDNAME":"Stella Luna","GNDCODE":"L241","RN":"79","GNDGID":"1000077"},{"GNDNAME":"Sulwhasoo","GNDCODE":"L125","RN":"80","GNDGID":"1000078"},{"GNDNAME":"Superdry","GNDCODE":"LG160","RN":"81","GNDGID":"1000079"},{"GNDNAME":"Ted Baker","GNDCODE":"L265","RN":"82","GNDGID":"1000080"},{"GNDNAME":"The Disney Store","GNDCODE":"L201\/L205","RN":"83","GNDGID":"1000081"},{"GNDNAME":"Tomic","GNDCODE":"L388","RN":"84","GNDGID":"1000082"},{"GNDNAME":"TOMMY Hilfiger","GNDCODE":"L266","RN":"85","GNDGID":"1000083"},{"GNDNAME":"UOOYAA","GNDCODE":"L315","RN":"86","GNDGID":"1000084"},{"GNDNAME":"URLAZH","GNDCODE":"L327","RN":"87","GNDGID":"1000085"},{"GNDNAME":"Woody Baker","GNDCODE":"LG218","RN":"88","GNDGID":"1000086"},{"GNDNAME":"ZHUCHONGYUN","GNDCODE":"L237","RN":"89","GNDGID":"1000087"},{"GNDNAME":"ZWILLING HOME","GNDCODE":"W101","RN":"90","GNDGID":"1000088"},{"GNDNAME":"单农","GNDCODE":"L332","RN":"91","GNDGID":"1000089"},{"GNDNAME":"见面谈","GNDCODE":"LG202","RN":"92","GNDGID":"1000090"},{"GNDNAME":"木仔记","GNDCODE":"LG224","RN":"93","GNDGID":"1000091"},{"GNDNAME":"上海总会","GNDCODE":"L418","RN":"94","GNDGID":"1000092"},{"GNDNAME":"Koyama","GNDCODE":"L428","RN":"95","GNDGID":"1000093"},{"GNDNAME":"Banxiaoxue","GNDCODE":"L317","RN":"96","GNDGID":"1000120"},{"GNDNAME":"bebe","GNDCODE":"L236","RN":"97","GNDGID":"1000121"},{"GNDNAME":"Camicissima","GNDCODE":"L272","RN":"98","GNDGID":"1000122"},{"GNDNAME":"Club Monaco","GNDCODE":"L235","RN":"99","GNDGID":"1000123"},{"GNDNAME":"CNCN","GNDCODE":"LG131","RN":"100","GNDGID":"1000124"}],"FMSG":"查询成功"}</sOutParams></NS1:DoClientCommandResponse></SOAP-ENV:Body></SOAP-ENV:Envelope>
XML

response_return = ''
response_error = ''
response_params = ''
response_stores = []
document = Oga.parse_xml(xml)
document.xpath("Envelope/Body/DoClientCommandResponse").each do |res|
  response_return = res.at_xpath('return').text
  response_error = res.at_xpath('sErrMsg').text
  response_params = res.at_xpath('sOutParams').text
end

if response_return == '0' && response_error.empty?
  response_hash = JSON.parse(response_params)
  if response_hash['FRESULT'].to_i == 0
    response_stores += response_hash['FDATA']
  else
    puts response_hash['FMSG']
  end
end

puts response_stores.length

